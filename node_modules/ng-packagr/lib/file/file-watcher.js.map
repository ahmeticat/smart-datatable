{"version":3,"file":"file-watcher.js","sourceRoot":"","sources":["../../../src/lib/file/file-watcher.ts"],"names":[],"mappings":";;AAAA,6BAA6B;AAC7B,qCAAqC;AACrC,+BAA4C;AAC5C,uCAA8C;AAC9C,mCAAmC;AASnC,SAAgB,eAAe,CAC7B,WAAmB,EACnB,eAAoC,EAAE;IAEtC,GAAG,CAAC,KAAK,CAAC,sCAAsC,WAAW,mBAAmB,YAAY,EAAE,CAAC,CAAC;IAE9F,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,WAAW,EAAE;QACxC,aAAa,EAAE,IAAI;QACnB,OAAO,EAAE,CAAC,GAAG,YAAY,EAAE,oDAAoD,CAAC;QAChF,UAAU,EAAE,IAAI;KACjB,CAAC,CAAC;IAEH,MAAM,gBAAgB,GAAG,CAAC,KAAqB,EAAE,QAAgB,EAAE,QAAoC,EAAE,EAAE;QACzG,GAAG,CAAC,KAAK,CAAC,+BAA+B,KAAK,WAAW,QAAQ,EAAE,CAAC,CAAC;QAErE,MAAM,aAAa,GAAqB,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;QAEhE,IAAI,aAAa,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;YACjC,2GAA2G;YAC3G,OAAO;SACR;QAED,QAAQ,CAAC,IAAI,CAAC;YACZ,QAAQ,EAAE,IAAI,CAAC,OAAO,CAAC,qBAAc,CAAC,QAAQ,CAAC,CAAC;YAChD,KAAK;SACN,CAAC,CAAC;IACL,CAAC,CAAC;IAEF,OAAO,iBAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE;QAClC,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC,KAAqB,EAAE,QAAgB,EAAE,EAAE,CAAC,gBAAgB,CAAC,KAAK,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC;QAC1G,OAAO,GAAG,EAAE,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;IAC7B,CAAC,CAAC,CAAC;AACL,CAAC;AAhCD,0CAgCC","sourcesContent":["import * as path from 'path';\nimport * as chokidar from 'chokidar';\nimport { Observer, Observable } from 'rxjs';\nimport { ensureUnixPath } from '../util/path';\nimport * as log from '../util/log';\n\nexport type FileWatchEvent = 'change' | 'unlink' | 'add' | 'unlinkDir' | 'addDir';\n\nexport interface FileChangedEvent {\n  filePath: string;\n  event: FileWatchEvent;\n}\n\nexport function createFileWatch(\n  projectPath: string,\n  ignoredPaths: (RegExp | string)[] = [],\n): Observable<FileChangedEvent> {\n  log.debug(`Watching for changes: projectPath: ${projectPath}, ignoredPaths: ${ignoredPaths}`);\n\n  const watch = chokidar.watch(projectPath, {\n    ignoreInitial: true,\n    ignored: [...ignoredPaths, /((^[\\/\\\\])\\..)|(\\.js$)|(\\.map$)|(\\.metadata\\.json)/],\n    persistent: true,\n  });\n\n  const handleFileChange = (event: FileWatchEvent, filePath: string, observer: Observer<FileChangedEvent>) => {\n    log.debug(`Watch: Path changed. Event: ${event}, Path: ${filePath}`);\n\n    const ignoredEvents: FileWatchEvent[] = ['unlinkDir', 'addDir'];\n\n    if (ignoredEvents.includes(event)) {\n      // we don't need to trigger on directory removed or renamed as chokidar will fire the changes for each file\n      return;\n    }\n\n    observer.next({\n      filePath: path.resolve(ensureUnixPath(filePath)),\n      event,\n    });\n  };\n\n  return Observable.create(observer => {\n    watch.on('all', (event: FileWatchEvent, filePath: string) => handleFileChange(event, filePath, observer));\n    return () => watch.close();\n  });\n}\n"]}